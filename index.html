<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Guantes - Financiero & Edición</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body { background-color: #eef2f7; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card-dashboard { border: none; border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .card-dashboard:hover { transform: translateY(-5px); }
        .bg-ventas { background: linear-gradient(135deg, #5b73e8 0%, #4458b8 100%); }
        .bg-costos { background: linear-gradient(135deg, #f5a623 0%, #f76b1c 100%); }
        .bg-utilidad { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .input-editable { border: 2px solid #10b981 !important; background-color: #f0fdf4 !important; font-weight: bold; }
        .edit-mode-banner { display: none; background-color: #fff3cd; color: #856404; padding: 10px; border-radius: 5px; margin-bottom: 15px; border: 1px solid #ffeeba; font-weight: bold; text-align: center; }
    </style>
</head>
<body>

<div class="container py-4">
    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-secondary"><i class="bi bi-calculator-fill"></i> Control Financiero Guantes</h3>
        <button class="btn btn-outline-danger btn-sm" onclick="borrarTodo()"><i class="bi bi-trash3"></i> Resetear Todo</button>
    </div>

    <!-- TASAS -->
    <div class="card p-3 mb-4 border-0 shadow-sm bg-white">
        <div class="row g-2 align-items-end">
            <div class="col-md-2 fw-bold text-end text-uppercase small">Tasas Hoy:</div>
            <div class="col-md-4">
                <label class="small text-muted">BCV (Cobro Bs)</label>
                <div class="input-group input-group-sm">
                    <span class="input-group-text fw-bold">Bs.</span>
                    <input type="number" step="0.01" id="tasaBCV" class="form-control fw-bold" onchange="guardarTasas(); calcularPrevisualizacion();">
                </div>
            </div>
            <div class="col-md-4">
                <label class="small text-muted">USDT/Paralelo (Realidad)</label>
                <div class="input-group input-group-sm">
                    <span class="input-group-text fw-bold">Bs.</span>
                    <input type="number" step="0.01" id="tasaUSDT" class="form-control fw-bold" onchange="guardarTasas(); calcularPrevisualizacion();">
                </div>
            </div>
            <div class="col-md-2 text-center">
                <small id="gapInfo" class="badge bg-danger"></small>
            </div>
        </div>
    </div>

    <!-- NAVEGACIÓN -->
    <ul class="nav nav-pills nav-fill mb-3 bg-white p-2 rounded shadow-sm" id="myTab" role="tablist">
        <li class="nav-item"><button class="nav-link active fw-bold" id="tab-venta" data-bs-toggle="tab" data-bs-target="#venta-tab">1. Registro</button></li>
        <li class="nav-item"><button class="nav-link fw-bold" id="tab-historial" data-bs-toggle="tab" data-bs-target="#historial-tab">2. Finanzas (Historial)</button></li>
        <li class="nav-item"><button class="nav-link fw-bold" id="tab-inventario" data-bs-toggle="tab" data-bs-target="#inventario-tab">3. Inventario</button></li>
    </ul>

    <div class="tab-content">

        <!-- PESTAÑA 1: VENTA / EDICIÓN -->
        <div class="tab-pane fade show active bg-white p-4 rounded shadow-sm" id="venta-tab">

            <div id="bannerEdicion" class="edit-mode-banner">
                <i class="bi bi-pencil-square"></i> ESTÁS EN MODO EDICIÓN - El stock ha sido devuelto temporalmente
            </div>

            <form id="formVenta">
                <input type="hidden" id="editId"> <!-- ID para saber si editamos -->

                <div class="row g-3">
                    <div class="col-md-5">
                        <label class="form-label fw-bold">Modelo</label>
                        <select class="form-select" id="selProducto" required onchange="seleccionarProducto()">
                            <option value="">Seleccione...</option>
                            <!-- JS -->
                        </select>
                        <div id="infoStock" class="small mt-1 text-end fw-bold text-muted"></div>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-bold">Método de Pago</label>
                        <select class="form-select" id="selMetodo" onchange="verificarMetodo()">
                            <option value="BCV">Bolívares (BCV)</option>
                            <option value="USDT">USDT / Binance</option>
                            <option value="Efectivo">Dólar Efectivo (Manual)</option>
                        </select>
                    </div>

                    <div class="col-md-2">
                        <label class="form-label">Precio ($)</label>
                        <input type="number" step="0.01" id="inputPrecio" class="form-control" readonly onchange="calcularPrevisualizacion()">
                    </div>

                    <div class="col-md-2">
                        <label class="form-label">Cantidad</label>
                        <input type="number" id="inputCant" class="form-control" value="1" min="1" required onchange="calcularPrevisualizacion()">
                    </div>
                </div>

                <div class="row g-3 mt-2">
                    <div class="col-md-3">
                        <label class="form-label">Delivery ($)</label>
                        <input type="number" step="0.1" id="inputDelivery" class="form-control" value="0" onchange="calcularPrevisualizacion()">
                    </div>
                    <div class="col-md-9">
                        <div class="card bg-light border-0">
                            <div class="card-body p-2">
                                <div class="row text-center align-items-center">
                                    <div class="col-4 border-end">
                                        <small class="text-muted d-block">Cliente Paga</small>
                                        <span class="fw-bold fs-5">Bs <span id="viewBs">0.00</span></span>
                                    </div>
                                    <div class="col-4 border-end">
                                        <small class="text-primary d-block fw-bold">Ingreso Real</small>
                                        <span class="fw-bold fs-5 text-primary"><span id="viewRealUSDT">0.00</span> USDT</span>
                                    </div>
                                    <div class="col-4">
                                        <small class="text-success d-block fw-bold">Tu Utilidad</small>
                                        <span class="fw-bold fs-5 text-success"><span id="viewUtilidad">0.00</span> USDT</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2 mt-4 d-flex">
                    <button type="submit" id="btnSubmit" class="btn btn-primary flex-grow-1 p-3 fw-bold">
                        <i class="bi bi-plus-circle"></i> REGISTRAR OPERACIÓN
                    </button>
                    <button type="button" id="btnCancel" class="btn btn-secondary p-3 fw-bold d-none" onclick="cancelarEdicion()">
                        CANCELAR
                    </button>
                </div>
            </form>
        </div>

        <!-- PESTAÑA 2: FINANZAS (HISTORIAL) -->
        <div class="tab-pane fade" id="historial-tab">

            <!-- DASHBOARD -->
            <div class="row g-3 mb-4 text-center">
                <div class="col-md-4">
                    <div class="card-dashboard bg-ventas">
                        <h5>Venta Total Real</h5>
                        <h3 class="fw-bold" id="dashVentas">0.00</h3>
                        <small>USDT Recibidos</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card-dashboard bg-costos">
                        <h5>Costos Totales</h5>
                        <h3 class="fw-bold" id="dashCostos">0.00</h3>
                        <small>Mercancía ($6 base)</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card-dashboard bg-utilidad">
                        <h5>Utilidad Neta</h5>
                        <h3 class="fw-bold" id="dashUtilidad">0.00</h3>
                        <small>Ganancia Limpia</small>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end mb-2">
                <button onclick="exportarExcel()" class="btn btn-success btn-sm"><i class="bi bi-file-excel"></i> Exportar a Excel</button>
            </div>

            <div class="table-responsive bg-white p-3 rounded shadow-sm">
                <table class="table table-hover table-sm small align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Fecha</th>
                            <th>Modelo</th>
                            <th>Cant</th>
                            <th>Método</th>
                            <th>Real (USDT)</th>
                            <th>Utilidad</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaVentas"></tbody>
                </table>
            </div>
        </div>

        <!-- PESTAÑA 3: INVENTARIO -->
        <div class="tab-pane fade bg-white p-4 rounded shadow-sm" id="inventario-tab">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <h5><i class="bi bi-box-seam"></i> Inventario ($6 Costo Base)</h5>
                    <small class="text-muted">Edite el stock directamente en la tabla.</small>
                </div>
                <button class="btn btn-sm btn-outline-warning" onclick="resetFactory()">Restaurar Stock Inicial</button>
            </div>
            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Modelo</th>
                        <th>Talla</th>
                        <th>Precio Venta ($)</th>
                        <th style="width: 150px;">Stock</th>
                    </tr>
                </thead>
                <tbody id="tablaInv"></tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- CONFIGURACIÓN ---
    const COSTO_BASE = 6.00;

    const MODELOS_DEF = [
        { m: "Impermeables", p: 15, t: ["S","M","L","XL","XXL"] },
        { m: "Reforzados", p: 16, t: ["M","L","XL"] },
        { m: "Tácticos", p: 15, t: ["M","L","XL"] },
        { m: "Gym", p: 15, t: ["M","L","XL"] },
        { m: "Medio Dedos", p: 15, t: ["M","L","XL"] },
        { m: "Mitones", p: 15, t: ["M","L","XL"] }
    ];

    let db = {
        inv: JSON.parse(localStorage.getItem('v5_inv')) || [],
        ventas: JSON.parse(localStorage.getItem('v5_ventas')) || [],
        tasas: JSON.parse(localStorage.getItem('v5_tasas')) || { bcv: 37.00, usdt: 45.00 }
    };

    // --- INICIO ---
    document.addEventListener('DOMContentLoaded', () => {
        if(db.inv.length === 0) resetFactory(false);
        document.getElementById('tasaBCV').value = db.tasas.bcv;
        document.getElementById('tasaUSDT').value = db.tasas.usdt;
        renderApp();
    });

    // --- GUARDADO ---
    function guardar() {
        localStorage.setItem('v5_inv', JSON.stringify(db.inv));
        localStorage.setItem('v5_ventas', JSON.stringify(db.ventas));
        localStorage.setItem('v5_tasas', JSON.stringify(db.tasas));
    }

    function guardarTasas() {
        db.tasas.bcv = parseFloat(document.getElementById('tasaBCV').value) || 1;
        db.tasas.usdt = parseFloat(document.getElementById('tasaUSDT').value) || 1;
        guardar();
        const gap = ((db.tasas.usdt - db.tasas.bcv) / db.tasas.usdt) * 100;
        document.getElementById('gapInfo').innerText = `GAP: ${gap.toFixed(1)}%`;
    }

    function renderApp() {
        renderInventario();
        renderSelect();
        renderHistorial();
    }

    // --- INVENTARIO ---
    function resetFactory(ask=true) {
        if(ask && !confirm("¿Reiniciar todo el inventario a 50 unidades?")) return;
        db.inv = [];
        MODELOS_DEF.forEach(mod => {
            mod.t.forEach(talla => {
                db.inv.push({
                    id: Math.random().toString(36).substr(2,6),
                    modelo: mod.m,
                    talla: talla,
                    precio: mod.p,
                    stock: 50
                });
            });
        });
        guardar();
        renderApp();
    }

    function renderInventario() {
        const tbody = document.getElementById('tablaInv');
        tbody.innerHTML = '';
        db.inv.forEach(i => {
            tbody.innerHTML += `
                <tr>
                    <td>${i.modelo}</td>
                    <td><span class="badge bg-light text-dark border">${i.talla}</span></td>
                    <td>$${i.precio}</td>
                    <td><input type="number" class="form-control form-control-sm" style="width: 80px;" value="${i.stock}" onchange="actualizarStock('${i.id}', this.value)"></td>
                </tr>
            `;
        });
    }
    
    function actualizarStock(id, cantidad) {
        const stock = parseInt(cantidad, 10);
        if (isNaN(stock) || stock < 0) {
             Swal.fire("Valor inválido", "Por favor, ingrese un número positivo.", "error");
             renderApp(); // re-render to show original value
             return;
        }

        const item = db.inv.find(i => i.id === id);
        if(item) {
            item.stock = stock;
            guardar();
            renderApp();
        }
    }

    // --- FORMULARIO ---
    function renderSelect() {
        const sel = document.getElementById('selProducto');
        const val = sel.value;
        sel.innerHTML = '<option value="">Seleccione producto...</option>';
        db.inv.forEach((item, idx) => {
            sel.innerHTML += `<option value="${idx}">${item.modelo} [${item.talla}] (Stock: ${item.stock})</option>`;
        });
        sel.value = val;
    }

    function seleccionarProducto() {
        const idx = document.getElementById('selProducto').value;
        const info = document.getElementById('infoStock');
        const precioInput = document.getElementById('inputPrecio');

        if(idx === "") {
            info.innerText = "";
            precioInput.value = "";
            return;
        }

        const item = db.inv[idx];
        info.innerText = `Disponible: ${item.stock}`;
        info.className = item.stock > 0 ? "small mt-1 text-end fw-bold text-success" : "small mt-1 text-end fw-bold text-danger";

        // Solo cambiamos el precio si NO estamos en modo edición de efectivo
        // o si cambiamos de producto en una venta nueva
        if(document.getElementById('selMetodo').value !== 'Efectivo') {
            precioInput.value = item.precio;
        } else {
             // Si es efectivo y no hay precio puesto, sugerimos el de lista
             if(!precioInput.value) precioInput.value = item.precio;
        }
        calcularPrevisualizacion();
    }

    function verificarMetodo() {
        const metodo = document.getElementById('selMetodo').value;
        const input = document.getElementById('inputPrecio');
        const idx = document.getElementById('selProducto').value;

        if(metodo === 'Efectivo') {
            input.removeAttribute('readonly');
            input.classList.add('input-editable');
        } else {
            input.setAttribute('readonly', true);
            input.classList.remove('input-editable');
            if(idx !== "") input.value = db.inv[idx].precio;
        }
        calcularPrevisualizacion();
    }

    function calcularPrevisualizacion() {
        const idx = document.getElementById('selProducto').value;
        if(idx === "") return;

        const cant = parseFloat(document.getElementById('inputCant').value) || 0;
        const precioVenta = parseFloat(document.getElementById('inputPrecio').value) || 0;
        const delivery = parseFloat(document.getElementById('inputDelivery').value) || 0;
        const metodo = document.getElementById('selMetodo').value;

        const ventaNominal = (precioVenta * cant) + delivery;
        let totalBs = 0;
        let ingresoReal = 0;

        if(metodo === 'BCV') {
            totalBs = ventaNominal * db.tasas.bcv;
            ingresoReal = totalBs / db.tasas.usdt;
        } else {
            totalBs = ventaNominal * db.tasas.usdt;
            ingresoReal = ventaNominal;
        }

        const costoTotal = COSTO_BASE * cant;
        const utilidad = ingresoReal - costoTotal;

        document.getElementById('viewBs').innerText = totalBs.toLocaleString('es-VE', {minimumFractionDigits:2, maximumFractionDigits:2});
        document.getElementById('viewRealUSDT').innerText = ingresoReal.toFixed(2);
        document.getElementById('viewUtilidad').innerText = utilidad.toFixed(2);
    }

    // --- LÓGICA DE SUBMIT (CREAR O EDITAR) ---
    document.getElementById('formVenta').addEventListener('submit', (e) => {
        e.preventDefault();
        const idx = document.getElementById('selProducto').value;
        const cant = parseFloat(document.getElementById('inputCant').value);

        // Validación Stock
        if(db.inv[idx].stock < cant) return Swal.fire("Stock Insuficiente", `Solo hay ${db.inv[idx].stock}`, "error");

        // Calcular Valores Finales
        const precioUnit = parseFloat(document.getElementById('inputPrecio').value);
        const delivery = parseFloat(document.getElementById('inputDelivery').value) || 0;
        const metodo = document.getElementById('selMetodo').value;
        const ventaNominal = (precioUnit * cant) + delivery;

        let totalBs, ingresoReal;
        if(metodo === 'BCV') {
            totalBs = ventaNominal * db.tasas.bcv;
            ingresoReal = totalBs / db.tasas.usdt;
        } else {
            totalBs = ventaNominal * db.tasas.usdt;
            ingresoReal = ventaNominal;
        }

        const costoTotal = COSTO_BASE * cant;
        const utilidad = ingresoReal - costoTotal;

        const ventaObj = {
            id: Date.now(),
            fecha: new Date().toLocaleDateString(),
            modelo: db.inv[idx].modelo,
            talla: db.inv[idx].talla,
            invId: db.inv[idx].id, // Vinculamos por ID fijo
            cant: cant,
            precioUnit: precioUnit,
            delivery: delivery,
            metodo: metodo,
            totalBs: totalBs.toFixed(2),
            ingresoReal: ingresoReal.toFixed(2),
            costoTotal: costoTotal.toFixed(2),
            utilidad: utilidad.toFixed(2)
        };

        const editId = document.getElementById('editId').value;

        if(editId) {
            // MODO EDICIÓN: Reemplazamos
            const vIndex = db.ventas.findIndex(v => v.id == editId);
            if(vIndex !== -1) {
                ventaObj.id = parseInt(editId); // Mantener ID original
                ventaObj.fecha = db.ventas[vIndex].fecha; // Mantener fecha original
                db.ventas[vIndex] = ventaObj;
                Swal.fire("Actualizado", "La venta ha sido modificada", "success");
            }
            finalizarEdicion();
        } else {
            // MODO NUEVO
            db.ventas.push(ventaObj);
            Swal.fire({ title: `Ganancia: ${utilidad.toFixed(2)} USDT`, icon: "success", timer: 1500, showConfirmButton:false });
        }

        // Restar Stock Nuevo
        db.inv[idx].stock -= cant;

        guardar();
        renderApp();

        if(!editId) limpiarFormulario();
    });

    function limpiarFormulario() {
        document.getElementById('formVenta').reset();
        document.getElementById('selProducto').value = "";
        document.getElementById('infoStock').innerText = "";
        document.getElementById('viewBs').innerText = "0.00";
        document.getElementById('viewRealUSDT').innerText = "0.00";
        document.getElementById('viewUtilidad').innerText = "0.00";
    }

    // --- SISTEMA DE EDICIÓN ---
    function editarVenta(id) {
        const venta = db.ventas.find(v => v.id === id);
        if(!venta) return;

        // 1. Encontrar item en inventario actual (por si cambió de orden)
        const invIdx = db.inv.findIndex(i => i.id === venta.invId || (i.modelo === venta.modelo && i.talla === venta.talla));

        if(invIdx === -1) return Swal.fire("Error", "El producto ya no existe en inventario", "error");

        // 2. DEVOLVER STOCK (Temporalmente mientras se edita)
        db.inv[invIdx].stock += parseFloat(venta.cant);
        guardar(); // Guardamos el stock devuelto por seguridad
        renderApp(); // Refrescamos tablas

        // 3. Llenar Formulario
        document.getElementById('selProducto').value = invIdx;
        seleccionarProducto(); // Carga datos stock visuales

        document.getElementById('inputCant').value = venta.cant;
        document.getElementById('selMetodo').value = venta.metodo;
        document.getElementById('inputDelivery').value = venta.delivery;

        // Manejo especial precio (si fue efectivo editado)
        verificarMetodo();
        document.getElementById('inputPrecio').value = venta.precioUnit;

        // 4. Activar Modo Edición
        document.getElementById('editId').value = venta.id;

        const btn = document.getElementById('btnSubmit');
        btn.innerHTML = '<i class="bi bi-save"></i> GUARDAR CAMBIOS';
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-warning');

        document.getElementById('btnCancel').classList.remove('d-none');
        document.getElementById('bannerEdicion').style.display = 'block';

        calcularPrevisualizacion();

        // Ir al tab 1
        new bootstrap.Tab(document.querySelector('#tab-venta')).show();
    }

    function cancelarEdicion() {
        const id = document.getElementById('editId').value;
        if(!id) return;

        // Recuperar la venta original para volver a descontar el stock que devolvimos
        const ventaOriginal = db.ventas.find(v => v.id == id);
        const invIdx = document.getElementById('selProducto').value; // El producto que estaba seleccionado

        // OJO: Si el usuario cambió el producto en el select antes de cancelar,
        // debemos buscar el producto original de la venta.
        const itemOriginalIdx = db.inv.findIndex(i => i.id === ventaOriginal.invId);

        if(itemOriginalIdx !== -1) {
            db.inv[itemOriginalIdx].stock -= parseFloat(ventaOriginal.cant);
            guardar();
            renderApp();
        }

        finalizarEdicion();
        Swal.fire("Cancelado", "No se realizaron cambios", "info");
    }

    function finalizarEdicion() {
        document.getElementById('editId').value = "";
        document.getElementById('btnCancel').classList.add('d-none');
        document.getElementById('bannerEdicion').style.display = 'none';

        const btn = document.getElementById('btnSubmit');
        btn.innerHTML = '<i class="bi bi-plus-circle"></i> REGISTRAR OPERACIÓN';
        btn.classList.add('btn-primary');
        btn.classList.remove('btn-warning');

        limpiarFormulario();
    }

    // --- HISTORIAL ---
    function renderHistorial() {
        const tbody = document.getElementById('tablaVentas');
        tbody.innerHTML = '';

        let tVentas = 0, tCostos = 0, tUtilidad = 0;

        [...db.ventas].reverse().forEach(v => {
            tVentas += parseFloat(v.ingresoReal);
            tCostos += parseFloat(v.costoTotal);
            tUtilidad += parseFloat(v.utilidad);

            tbody.innerHTML += `
                <tr>
                    <td>${v.fecha}</td>
                    <td>${v.modelo} <span class="badge bg-light text-dark border">${v.talla}</span></td>
                    <td>${v.cant}</td>
                    <td>${v.metodo}</td>
                    <td class="fw-bold text-primary">${v.ingresoReal}</td>
                    <td class="fw-bold text-success">${v.utilidad}</td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-warning text-dark" onclick="editarVenta(${v.id})" title="Editar"><i class="bi bi-pencil-fill"></i></button>
                        <button class="btn btn-sm btn-outline-danger border-0" onclick="borrarVenta(${v.id})" title="Borrar"><i class="bi bi-trash-fill"></i></button>
                    </td>
                </tr>
            `;
        });

        document.getElementById('dashVentas').innerText = tVentas.toFixed(2) + " USDT";
        document.getElementById('dashCostos').innerText = tCostos.toFixed(2) + " USDT";
        document.getElementById('dashUtilidad').innerText = tUtilidad.toFixed(2) + " USDT";
    }

    function borrarVenta(id) {
        Swal.fire({
            title: "¿Eliminar Venta?",
            text: "El stock será devuelto al inventario.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Sí, borrar"
        }).then((r) => {
            if(r.isConfirmed) {
                const v = db.ventas.find(x => x.id === id);
                const idx = db.inv.findIndex(i => i.id === v.invId);
                if(idx !== -1) db.inv[idx].stock += parseFloat(v.cant);

                db.ventas = db.ventas.filter(x => x.id !== id);
                guardar();
                renderApp();
                Swal.fire("Borrado", "", "success");
            }
        });
    }

    function borrarTodo() {
        if(confirm("¿Estás seguro de borrar TODA la base de datos?")) {
            localStorage.clear();
            location.reload();
        }
    }

    function exportarExcel() {
        const data = db.ventas.map(v => ({
            Fecha: v.fecha,
            Modelo: v.modelo,
            Talla: v.talla,
            Cantidad: v.cant,
            Metodo: v.metodo,
            Bs_Recibidos: parseFloat(v.totalBs),
            Ingreso_Real_USDT: parseFloat(v.ingresoReal),
            Costo_Total: parseFloat(v.costoTotal),
            Utilidad_Neta: parseFloat(v.utilidad)
        }));
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Finanzas");
        XLSX.writeFile(wb, "Reporte_Ventas_Guantes.xlsx");
    }
</script>

</body>
</html>
